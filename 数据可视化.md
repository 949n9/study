# 数据可视化

http://datav.jiaminghi.com/

ui库

需要websocket的支持

http://www.ruanyifeng.com/blog/2017/05/websocket.html

阮一峰的websock初级教程

```JS
function connect() {
  // 以ws(s)开头的URL
  var serverUrl = "ws://" + window.location.hostname + ":6502";
  // 创建连接
  connection = new WebSocket(serverUrl);
  connection.onopen = function(evt) {
    // 成功建立连接
  };

  connection.onmessage = function(evt) {
  // 从服务端接受到的消息
    var msg = JSON.parse(evt.data);
  //通过判断消息type，执行相关操作
    switch(msg.type) {
      case "id":
        // ...
        break;
      case "username":
        // ...
        break;
      case "message":
        // ...
        break;    
    }
}
```



```html
<template>
    <div class="chart">
        <div class="container">
            <el-input type="text" v-model="text" />
            <el-button @click="send">发送消息</el-button>
            
            
            <el-button @click="closeWebSocket()">关闭websocket连接</el-button>
            
            <div>{{ data }}</div>
        </div>
    </div>
</template>

<script>
import axios from 'axios';
import common from '../common/common.js';

export default {
    name: 'chart',
    data() {
        return {
            
            text: '',    ////发送内容
            data: '',    ////响应数据
            websocket: null,
        };
    },
    created() {
        this.apiUrl = common.apiUrl;      ////接口

        this.token = 'Token ' + localStorage.getItem('token');  ////
token

    },
    mounted() {
        if ('WebSocket' in window) {    ////打开时判断socket连接状态
            this.websocket = new WebSocket('ws://47.94.0.83:8889/ws/chants/zyf/');
            this.initWebSocket();
        } else {
            alert('当前浏览器不支持即时聊天，请升级浏览器或更换浏览器使用！！');
        }
    },
    beforeDestroy() {    ////关闭时断开socket连接
        this.onbeforeunload();
    },

    methods: {
        initWebSocket() {    ////初始化
            //连接错误
            this.websocket.onerror = this.setErrorMessage;

            // //连接成功
            this.websocket.onopen = this.setOnopenMessage;

            //收到消息的回调
            this.websocket.onmessage = this.setOnmessageMessage;

            //连接关闭的回调
            this.websocket.onclose = this.setOncloseMessage;

            //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
            window.onbeforeunload = this.onbeforeunload;
        },
        setErrorMessage() {
            this.data = 'WebSocket连接发生错误' + '   状态码：' + this.websocket.readyState;
        },
        setOnopenMessage() {
            this.data = 'WebSocket连接成功' + '   状态码：' + this.websocket.readyState;
        },
        setOnmessageMessage(event) {
            this.data = '服务端返回：' + event.data;
        },
        setOncloseMessage() {
            this.data = 'WebSocket连接关闭' + '   状态码：' + this.websocket.readyState;
        },
        onbeforeunload() {
            this.closeWebSocket();
        },

        //websocket发送消息
        send() {
            this.messages = {
                token:this.token,
                text:this.text,
            }
            
            this.websocket.send(this.text);
            // this.websocket.send(this.messages);
            this.text = '';
            // this.messages = {};
        },
        closeWebSocket() {
            this.websocket.close();
        }
    },

};
</script>

<style scoped>
.container {
    /* background: rgba(255,255,255,0); */
    border: 0;
}
.handle-box {
    border-bottom: 2px solid #999;
    padding-bottom: 10px;
}
.sheetcontent {
    margin-top: 10px;
    overflow: hidden;
    box-sizing: border-box;
}
.sheetlib {
    width: 20%;
    float: left;
    overflow: hidden;
    box-sizing: border-box;
}
.sheetlib:hover {
    transform: scale(1.03);
}
.sheetlist {
    margin: 5px;
    padding: 5px 0 0 0;
    background: #fff;
    border: 1px solid #eee;
    overflow: hidden;
    box-sizing: border-box;
}
.sheettitle {
    padding: 10px;
}
.sheetbtn {
    cursor: pointer;
    margin-top: 10px;
    border-top: 1px solid #eee;
}
.btnli {
    width: 33.333%;
    float: left;
    overflow: hidden;
    box-sizing: border-box;
    font-size: 14px;
    text-align: center;
    padding: 5px;
}

.li1 {
    color: #ffd700;
}
.li2 {
    color: #9f79ee;
}
.li3 {
    color: #cd3700;
}
.btnli {
    /* background: #B4EEB4; */
    border-right: 1px solid #eee;
}
.btnli:last-child {
    /* background: #CAE1FF; */
    border-right: 0;
}
</style>
```





echarts

```
<template>
    <div class="mapbody">
        <!--        <div class="chart" id="mapChart"></div>-->
<!--        <div class="chart" id="mapContainer"></div>-->
        <div class="chart" id="mapChart"></div>
    </div>
</template>
<script>
    import chinaJson from 'echarts/map/json/china.json'
    function formatLargeNumber(num) {
        num = num / 10000;
        num = num.toFixed(2);
        return num;
    }

    export default{
        data() {
            return {
                provinceSale: [{"name": "安徽", "value": 1281924.04}, {"name": "北京", "value": 1740834.61}, {
                    "name": "福建",
                    "value": 1527851.97
                }, {"name": "甘肃", "value": 1263797.84}, {"name": "广东", "value": 1897525.56}, {
                    "name": "广西",
                    "value": 942419.38
                }, {"name": "贵州", "value": 903811.1}, {"name": "海南", "value": 891996.77}, {
                    "name": "河北",
                    "value": 956542.16
                }, {"name": "河南", "value": 806524.49}, {"name": "黑龙江", "value": 766534.02}, {
                    "name": "湖北",
                    "value": 778046.06
                }, {"name": "湖南", "value": 1437962.33}, {"name": "吉林", "value": 1103217.26}, {
                    "name": "江苏",
                    "value": 1331694.44
                }, {"name": "江西", "value": 910583.23}, {"name": "辽宁", "value": 1417750.03}, {
                    "name": "内蒙古",
                    "value": 1139955.46
                }, {"name": "宁夏", "value": 797518.77}, {"name": "青海", "value": 632022.57}, {
                    "name": "山东",
                    "value": 1231800.22
                }, {"name": "山西", "value": 536195.23}, {"name": "陕西", "value": 592725.6}, {
                    "name": "上海",
                    "value": 1813714.79
                }, {"name": "四川", "value": 1014240.54}, {"name": "天津", "value": 1278654.56}, {
                    "name": "西藏",
                    "value": 692687.19
                }, {"name": "新疆", "value": 1084279.21}, {"name": "云南", "value": 887189.6}, {
                    "name": "浙江",
                    "value": 1263946.23
                }, {"name": "重庆", "value": 786951.66}]
            }
        },
        methods:{
            drawMapChart(){
                var dataList=[
                    {name:"南海诸岛",value:0},
                    {name: '北京', value: 0},
                    {name: '天津', value: 0},
                    {name: '上海', value: 0},
                    {name: '重庆', value: 0},
                    {name: '河北', value: randomValue()},
                    {name: '河南', value: randomValue()},
                    {name: '云南', value: randomValue()},
                    {name: '辽宁', value: randomValue()},
                    {name: '黑龙江', value: randomValue()},
                    {name: '湖南', value: randomValue()},
                    {name: '安徽', value: randomValue()},
                    {name: '山东', value: randomValue()},
                    {name: '新疆', value: randomValue()},
                    {name: '江苏', value: randomValue()},
                    {name: '浙江', value: randomValue()},
                    {name: '江西', value: randomValue()},
                    {name: '湖北', value: randomValue()},
                    {name: '广西', value: randomValue()},
                    {name: '甘肃', value: randomValue()},
                    {name: '山西', value: randomValue()},
                    {name: '内蒙古', value: randomValue()},
                    {name: '陕西', value: randomValue()},
                    {name: '吉林', value: randomValue()},
                    {name: '福建', value: randomValue()},
                    {name: '贵州', value: randomValue()},
                    {name: '广东', value: randomValue()},
                    {name: '青海', value: randomValue()},
                    {name: '西藏', value: randomValue()},
                    {name: '四川', value: randomValue()},
                    {name: '宁夏', value: randomValue()},
                    {name: '海南', value: randomValue()},
                    {name: '台湾', value: randomValue()},
                    {name: '香港', value: randomValue()},
                    {name: '澳门', value: randomValue()}
                ]
                //初始化echarts实例
                this.$echarts.registerMap('china', chinaJson)
                var myChart = this.$echarts.init(document.getElementById('mapChart'));
                function randomValue() {
                    return Math.round(Math.random()*1000);
                }
                let  option = {
                    tooltip: {
                        formatter:function(params,ticket, callback){
                            return params.seriesName+'<br />'+params.name+'：'+params.value
                        }//数据格式化
                    },
                    visualMap: {
                        min: 0,
                        max: 1500,
                        left: 'left',
                        top: 'bottom',
                        text: ['高','低'],//取值范围的文字
                        textStyle:{
                            color:'#ffffff'
                        },
                        inRange: {
                            color: ['#e0ffff', '#006edd']//取值范围的颜色
                        },
                        show:true//图注
                    },
                    geo: {
                        map: 'china',
                        roam: false,//不开启缩放和平移
                        zoom:1.23,//视角缩放比例
                        label: {
                            normal: {
                                show: true,
                                fontSize:'10',
                                color: 'rgba(0,0,0,0.7)'
                            }
                        },
                        itemStyle: {
                            normal:{
                                borderColor: 'rgba(0, 0, 0, 0.2)'
                            },
                            emphasis:{
                                areaColor: '#F3B329',//鼠标选择区域颜色
                                shadowOffsetX: 0,
                                shadowOffsetY: 0,
                                shadowBlur: 20,
                                borderWidth: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    },
                    series : [
                        {
                            name: '信息量',
                            type: 'map',
                            geoIndex: 0,
                            data:dataList
                        }
                    ]
                };
                myChart.setOption(option);

            },
            drawMultiChart2() {
                let that = this;
                let categorySale = this.categorySale;

                var provinceSale = JSON.parse(JSON.stringify(this.provinceSale));
                var data = [
                    {name: '海门', value: 9},
                    {name: '鄂尔多斯', value: 12},
                    {name: '招远', value: 12},
                    {name: '舟山', value: 12},
                    {name: '齐齐哈尔', value: 14},
                    {name: '盐城', value: 15},
                    {name: '赤峰', value: 16},
                    {name: '青岛', value: 18},
                    {name: '乳山', value: 18},
                    {name: '金昌', value: 19},
                    {name: '泉州', value: 21},
                    {name: '莱西', value: 21},
                    {name: '日照', value: 21},
                    {name: '胶南', value: 22},
                    {name: '南通', value: 23},
                    {name: '拉萨', value: 24},
                    {name: '云浮', value: 24},
                    {name: '梅州', value: 25},
                    {name: '文登', value: 25},
                    {name: '上海', value: 25},
                    {name: '攀枝花', value: 25},
                    {name: '威海', value: 25},
                    {name: '承德', value: 25},
                    {name: '厦门', value: 26},
                    {name: '汕尾', value: 26},
                    {name: '潮州', value: 26},
                    {name: '丹东', value: 27},
                    {name: '太仓', value: 27},
                    {name: '曲靖', value: 27},
                    {name: '烟台', value: 28},
                    {name: '福州', value: 29},
                    {name: '瓦房店', value: 30},
                    {name: '即墨', value: 30},
                    {name: '抚顺', value: 31},
                    {name: '玉溪', value: 31},
                    {name: '张家口', value: 31},
                    {name: '阳泉', value: 31},
                    {name: '莱州', value: 32},
                    {name: '湖州', value: 32},
                    {name: '汕头', value: 32},
                    {name: '昆山', value: 33},
                    {name: '宁波', value: 33},
                    {name: '湛江', value: 33},
                    {name: '揭阳', value: 34},
                    {name: '荣成', value: 34},
                    {name: '连云港', value: 35},
                    {name: '葫芦岛', value: 35},
                    {name: '常熟', value: 36},
                    {name: '东莞', value: 36},
                    {name: '河源', value: 36},
                    {name: '淮安', value: 36},
                    {name: '泰州', value: 36},
                    {name: '南宁', value: 37},
                    {name: '营口', value: 37},
                    {name: '惠州', value: 37},
                    {name: '江阴', value: 37},
                    {name: '蓬莱', value: 37},
                    {name: '韶关', value: 38},
                    {name: '嘉峪关', value: 38},
                    {name: '广州', value: 38},
                    {name: '延安', value: 38},
                    {name: '太原', value: 39},
                    {name: '清远', value: 39},
                    {name: '中山', value: 39},
                    {name: '昆明', value: 39},
                    {name: '寿光', value: 40},
                    {name: '盘锦', value: 40},
                    {name: '长治', value: 41},
                    {name: '深圳', value: 41},
                    {name: '珠海', value: 42},
                    {name: '宿迁', value: 43},
                    {name: '咸阳', value: 43},
                    {name: '铜川', value: 44},
                    {name: '平度', value: 44},
                    {name: '佛山', value: 44},
                    {name: '海口', value: 44},
                    {name: '江门', value: 45},
                    {name: '章丘', value: 45},
                    {name: '肇庆', value: 46},
                    {name: '大连', value: 47},
                    {name: '临汾', value: 47},
                    {name: '吴江', value: 47},
                    {name: '石嘴山', value: 49},
                    {name: '沈阳', value: 50},
                    {name: '苏州', value: 50},
                    {name: '茂名', value: 50},
                    {name: '嘉兴', value: 51},
                    {name: '长春', value: 51},
                    {name: '胶州', value: 52},
                    {name: '银川', value: 52},
                    {name: '张家港', value: 52},
                    {name: '三门峡', value: 53},
                    {name: '锦州', value: 54},
                    {name: '南昌', value: 54},
                    {name: '柳州', value: 54},
                    {name: '三亚', value: 54},
                    {name: '自贡', value: 56},
                    {name: '吉林', value: 56},
                    {name: '阳江', value: 57},
                    {name: '泸州', value: 57},
                    {name: '西宁', value: 57},
                    {name: '宜宾', value: 58},
                    {name: '呼和浩特', value: 58},
                    {name: '成都', value: 58},
                    {name: '大同', value: 58},
                    {name: '镇江', value: 59},
                    {name: '桂林', value: 59},
                    {name: '张家界', value: 59},
                    {name: '宜兴', value: 59},
                    {name: '北海', value: 60},
                    {name: '西安', value: 61},
                    {name: '金坛', value: 62},
                    {name: '东营', value: 62},
                    {name: '牡丹江', value: 63},
                    {name: '遵义', value: 63},
                    {name: '绍兴', value: 63},
                    {name: '扬州', value: 64},
                    {name: '常州', value: 64},
                    {name: '潍坊', value: 65},
                    {name: '重庆', value: 66},
                    {name: '台州', value: 67},
                    {name: '南京', value: 67},
                    {name: '滨州', value: 70},
                    {name: '贵阳', value: 71},
                    {name: '无锡', value: 71},
                    {name: '本溪', value: 71},
                    {name: '克拉玛依', value: 72},
                    {name: '渭南', value: 72},
                    {name: '马鞍山', value: 72},
                    {name: '宝鸡', value: 72},
                    {name: '焦作', value: 75},
                    {name: '句容', value: 75},
                    {name: '北京', value: 79},
                    {name: '徐州', value: 79},
                    {name: '衡水', value: 80},
                    {name: '包头', value: 80},
                    {name: '绵阳', value: 80},
                    {name: '乌鲁木齐', value: 84},
                    {name: '枣庄', value: 84},
                    {name: '杭州', value: 84},
                    {name: '淄博', value: 85},
                    {name: '鞍山', value: 86},
                    {name: '溧阳', value: 86},
                    {name: '库尔勒', value: 86},
                    {name: '安阳', value: 90},
                    {name: '开封', value: 90},
                    {name: '济南', value: 92},
                    {name: '德阳', value: 93},
                    {name: '温州', value: 95},
                    {name: '九江', value: 96},
                    {name: '邯郸', value: 98},
                    {name: '临安', value: 99},
                    {name: '兰州', value: 99},
                    {name: '沧州', value: 100},
                    {name: '临沂', value: 103},
                    {name: '南充', value: 104},
                    {name: '天津', value: 105},
                    {name: '富阳', value: 106},
                    {name: '泰安', value: 112},
                    {name: '诸暨', value: 112},
                    {name: '郑州', value: 113},
                    {name: '哈尔滨', value: 114},
                    {name: '聊城', value: 116},
                    {name: '芜湖', value: 117},
                    {name: '唐山', value: 119},
                    {name: '平顶山', value: 119},
                    {name: '邢台', value: 119},
                    {name: '德州', value: 120},
                    {name: '济宁', value: 120},
                    {name: '荆州', value: 127},
                    {name: '宜昌', value: 130},
                    {name: '义乌', value: 132},
                    {name: '丽水', value: 133},
                    {name: '洛阳', value: 134},
                    {name: '秦皇岛', value: 136},
                    {name: '株洲', value: 143},
                    {name: '石家庄', value: 147},
                    {name: '莱芜', value: 148},
                    {name: '常德', value: 152},
                    {name: '保定', value: 153},
                    {name: '湘潭', value: 154},
                    {name: '金华', value: 157},
                    {name: '岳阳', value: 169},
                    {name: '长沙', value: 175},
                    {name: '衢州', value: 177},
                    {name: '廊坊', value: 193},
                    {name: '菏泽', value: 194},
                    {name: '合肥', value: 229},
                    {name: '武汉', value: 273},
                    {name: '大庆', value: 279}
                ];
                var geoCoordMap = {
                    '上海': [121.4648, 31.2891],
                    '新疆': [87.9236, 43.5883],
                    '甘肃': [103.5901, 36.3043],
                    '总部': [70.4551, 50.2539],
                    '北京': [116.4551, 40.2539],
                    '江苏': [118.8062, 31.9208],
                    '广西': [108.479, 23.1152],
                    '江西': [116.0046, 28.6633],
                    '安徽': [117.29, 32.0581],
                    '内蒙古': [111.4124, 40.4901],
                    '黑龙江': [127.9688, 45.368],
                    '天津': [117.4219, 39.4189],
                    '山西': [112.3352, 37.9413],
                    '广东': [113.5107, 23.2196],
                    '四川': [103.9526, 30.7617],
                    '西藏': [91.1865, 30.1465],
                    '云南': [102.9199, 25.4663],
                    '浙江': [119.5313, 29.8773],
                    '湖北': [114.3896, 30.6628],
                    '辽宁': [123.1238, 42.1216],
                    '山东': [117.1582, 36.8701],
                    '海南': [110.3893, 19.8516],
                    '河北': [114.4995, 38.1006],
                    '福建': [119.4543, 25.9222],
                    '青海': [101.4038, 36.8207],
                    '陕西': [109.1162, 34.2004],
                    '贵州': [106.6992, 26.7682],
                    '河南': [113.4668, 34.6234],
                    '重庆': [107.7539, 30.1904],
                    '宁夏': [106.3586, 38.1775],
                    '吉林': [125.8154, 44.2584],
                    '湖南': [113.0823, 28.2568]
                }
                var convertData2 = function (originData) {
                    var res = [];
                    var data = JSON.parse(JSON.stringify(originData))
                    for (var i = 0; i < data.length; i++) {
                        var geoCoord = geoCoordMap[data[i].name];
                        if (geoCoord) {
                            res.push({
                                name: data[i].name,
                                value: geoCoord.concat(parseInt(formatLargeNumber(data[i].value)))
                            });
                        }
                    }
                    return res;
                };
                this.$echarts.registerMap('china', chinaJson)
                var myChart = this.$echarts.init(document.getElementById('mapContainer'));
                //每次窗口大小改变的时候都会触发onresize事件，这个时候我们将echarts对象的尺寸赋值给窗口的大小这个属性，从而实现图表对象与窗口对象的尺寸一致的情况
                window.onresize = myChart.resize;
                var option = {
                    backgroundColor: 'transparent',
                    title: {
                        top: 50,
                        left: 265,
                        text: '销量地域分布',
                        subtext: '',
                        x: 'left',
                        textStyle: {
                            color: '#ccc'
                        }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                            type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                        },
                        formatter: function (params) {
                            if (typeof (params.value)[2] == "undefined") {
                                //return params.name + ' : ' + params.value;
                            } else {//只有数据不为空才显示
                                return params.name + ' : ' + params.value[2];
                            }
                        }
                    },
                    visualMap: {//左侧小导航图标
                        show: true,
                        x: 'left',
                        y: 'center',
                        top: '650',
                        textStyle: {
                            color: "#8fc8f2"
                        },
                        splitList: [
                            {start: 200}, {start: 150, end: 200},
                            {start: 100, end: 150}, {start: 50, end: 100},
                            {start: 0, end: 50}
                        ],
                        color: ['#9fb5ea', '#00FFFF', '#85daef', '#74e2ca', '#e6ac53']
                    },
                    tooltip: {
                        trigger: 'item'
                    },
                    //布局e
                    geo: {
                        show: true,
                        map: 'china',
                        // zoom: 1,  //地图绽放
                        //  scaleLimit: 2,
                        label: {
                            normal: {
                                show: true,
                                textStyle: {
                                    color: '#ccc'
                                }
                            },
                            emphasis: {
                                show: false,
                            }
                        },
                        roam: true,//是否开启鼠标缩放和平移漫游
                        itemStyle: {
                            normal: {
                                areaColor: 'transparent',
                                // borderColor: '#3fdaff',
                                borderWidth: 1,
                                shadowColor: 'rgba(63, 218, 255, 0.5)',
                                shadowBlur: 50
                            },
                            emphasis: {
                                areaColor: '#2B91B7',
                                color: '#fff'
                            }
                        }
                    },
                    //调整显示级别
                    layoutCenter: ['50%', '50%'],
                    layoutSize: 620,
                    series: [
                        {
                            name: '销售额',
                            type: 'scatter',
                            coordinateSystem: 'geo',
                            data: convertData2(provinceSale),
                            symbolSize: function (val) {
                                return val[2] / 10;
                            },
                            label: {
                                normal: {
                                    formatter: function (a) {
                                        return a.value[2] + "万元";
                                    },
                                    position: 'right',
                                    show: false
                                },
                                emphasis: {
                                    show: true
                                }
                            },
                            tooltip: {
                                formatter: function (a) {
                                    return `${a.name} ${a.seriesName}<br/>${a.value[2]}万元`
                                }
                            },
                        },
                        {
                            name: '销售额前三名',
                            type: 'effectScatter',
                            coordinateSystem: 'geo',
                            data: convertData2(provinceSale.sort(function (a, b) {
                                return b.value - a.value;
                            }).slice(0, 3)),
                            symbolSize: function (val) {
                                return val[2] / 10;
                            },
                            showEffectOn: 'render',
                            rippleEffect: {
                                brushType: 'stroke'
                            },
                            hoverAnimation: true,
                            label: {
                                normal: {
                                    formatter: function (a) {
                                        return a.value[2] + "元";
                                    },
                                    position: 'right',
                                    show: true
                                }
                            },
                            tooltip: {
                                formatter: function (a) {
                                    return `${a.name} ${a.seriesName}<br/>${a.value[2]}万元`
                                }
                            },
                            zlevel: 1
                        },
                    ]
                };
                myChart.setOption(option);
            },
        },
        mounted(){
            this.drawMapChart();
            // this.drawMultiChart2()
        }
    }
</script>
<style>
    mapbody{}
    .chart{
        height:599px;
        width: 620px;
        overflow: hidden;
        background-color: #010d28;
    }
</style>
```